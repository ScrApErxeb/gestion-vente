{% extends "base.html" %}

{% block title %}Commandes Fournisseurs - GestioStock{% endblock %}

{% block content %}
<div class="header">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/commandes.css') }}">

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>üìã Commandes Fournisseurs</h1>
            <p>G√©rez vos commandes d'approvisionnement</p>
        </div>
        <button class="btn btn-primary" onclick="toggleModal('modal-commande')">
            ‚ûï Nouvelle Commande
        </button> 
    </div>
</div>

<!-- Statistiques commandes -->
<div class="stat-cards">
    <div class="stat-card">
        <div class="icon">‚è≥</div>
        <div class="label">En attente</div>
        <div class="value" id="cmd-attente">0</div>
    </div>
    <div class="stat-card">
        <div class="icon">‚úÖ</div>
        <div class="label">Confirm√©es</div>
        <div class="value" id="cmd-confirmees">0</div>
    </div>
    <div class="stat-card">
        <div class="icon">üì¶</div>
        <div class="label">Re√ßues</div>
        <div class="value" id="cmd-recues">0</div>
    </div>
    <div class="stat-card">
        <div class="icon">üí∞</div>
        <div class="label">Montant total</div>
        <div class="value" id="cmd-montant">0 F</div>
    </div>
</div>

<!-- Filtres -->
<div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <div class="form-row">
        <div class="form-group" style="margin: 0;">
            <select id="filter-fournisseur" onchange="filtrerCommandes()">
                <option value="">Tous les fournisseurs</option>
            </select>
        </div>
        <div class="form-group" style="margin: 0;">
            <select id="filter-statut-cmd" onchange="filtrerCommandes()">
                <option value="">Tous les statuts</option>
                <option value="en_attente">En attente</option>
                <option value="confirm√©e">Confirm√©e</option>
                <option value="re√ßue">Re√ßue</option>
                <option value="annul√©e">Annul√©e</option>
            </select>
        </div>
    </div>
</div>

<!-- Table des commandes -->
<div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <table id="commandes-table">
        <thead>
            <tr>
                <th>N¬∞ Commande</th>
                <th>Fournisseur</th>
                <th>Date commande</th>
                <th>Livraison pr√©vue</th>
                <th>Montant</th>
                <th>Articles</th>
                <th>Statut</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Modal Nouvelle Commande -->
<div id="modal-commande" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2>Nouvelle Commande Fournisseur</h2>
            <span class="modal-close" onclick="toggleModal('modal-commande')">&times;</span>
        </div>
        <form id="form-commande" onsubmit="saveCommande(event)">
            <div class="form-row">
                <div class="form-group">
                    <label>Fournisseur *</label>
                    <select name="fournisseur_id" id="cmd-fournisseur" required>
                        <option value="">S√©lectionner...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date livraison pr√©vue</label>
                    <input type="date" name="date_livraison_prevue" id="cmd-date-livraison">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Mode de paiement</label>
                    <select name="mode_paiement" id="cmd-paiement">
                        <option value="comptant">Comptant</option>
                        <option value="cr√©dit">√Ä cr√©dit</option>
                        <option value="virement">Virement</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Devise</label>
                    <select name="devise" id="cmd-devise">
                        <option value="XOF">F CFA</option>
                        <option value="EUR">Euro</option>
                        <option value="USD">Dollar</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Notes</label>
                <textarea name="notes" id="cmd-notes" rows="2"></textarea>
            </div>
            
            <hr style="margin: 20px 0;">
            
            <h3 style="margin-bottom: 15px;">Articles de la commande</h3>
            
            <div id="cmd-items-container">
                <div class="cmd-item" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 50px; gap: 10px; margin-bottom: 10px; align-items: end;">
                    <div class="form-group" style="margin: 0;">
                        <label>Produit</label>
                        <select class="item-produit" required>
                            <option value="">S√©lectionner...</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <label>Quantit√©</label>
                        <input type="number" class="item-quantite" min="1" required onchange="calculerTotalCommande()">
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <label>Prix unitaire</label>
                        <input type="number" class="item-prix" step="0.01" required onchange="calculerTotalCommande()">
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <label>Total</label>
                        <input type="text" class="item-total" readonly style="background: #f8f9fa;">
                    </div>
                    <button type="button" class="btn btn-danger btn-sm" onclick="retirerItem(this)" style="height: 42px;">‚ùå</button>
                </div>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="ajouterItem()" style="margin-top: 10px;">
                ‚ûï Ajouter un article
            </button>
            
            <div style="background: #e8f8f5; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 18px; font-weight: 600; color: #2c3e50;">TOTAL COMMANDE:</span>
                    <span style="font-size: 24px; font-weight: bold; color: #1abc9c;" id="cmd-total-final">0 F CFA</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">üì¶ Cr√©er la commande</button>
                <button type="button" class="btn btn-secondary" onclick="toggleModal('modal-commande')">‚ùå Annuler</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal R√©ception Commande -->
<div id="modal-reception" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h2>R√©ceptionner la commande</h2>
            <span class="modal-close" onclick="toggleModal('modal-reception')">&times;</span>
        </div>
        <div id="reception-content"></div>
    </div>
</div>
<script src="{{ url_for('static', filename='js/commandes.js') }}"></script>

{% endblock %}
