{% extends "base.html" %}

{% block title %}Produits - GestioStock{% endblock %}

{% block content %}
<div class="header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>üì¶ Gestion des Produits</h1>
            <p>Liste compl√®te de vos produits en stock</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn btn-secondary" onclick="exporterProduits()">
                üì• Exporter Excel
            </button>
            <button class="btn btn-primary" onclick="toggleModal('modal-produit')">
                ‚ûï Nouveau Produit
            </button>
        </div>
    </div>
</div>

<!-- Filtres -->
<div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <div class="form-row">
        <div class="form-group" style="margin: 0;">
            <input type="text" id="search-produit" placeholder="üîç Rechercher par nom, r√©f√©rence...">
        </div>
        <div class="form-group" style="margin: 0;">
            <select id="filter-categorie" onchange="filtrerProduits()">
                <option value="">Toutes les cat√©gories</option>
            </select>
        </div>
        <div class="form-group" style="margin: 0;">
            <select id="filter-stock" onchange="filtrerProduits()">
                <option value="">Tous les stocks</option>
                <option value="faible">Stock faible uniquement</option>
            </select>
        </div>
    </div>
</div>



<!-- Table des produits -->
<div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <table id="produits-table">
        <thead>
            <tr>
                <th>R√©f√©rence</th>
                <th>Nom</th>
                <th>Cat√©gorie</th>
                <th>Prix Achat</th>
                <th>Prix Vente</th>
                <th>Stock</th>
                <th>Valeur</th>
                <th>Statut</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Modal Nouveau/Modifier Produit -->
<div id="modal-produit" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modal-produit-title">Nouveau Produit</h2>
            <span class="modal-close" onclick="toggleModal('modal-produit')">&times;</span>
        </div>
        <form id="form-produit" onsubmit="saveProduit(event)">
            <input type="hidden" id="produit-id" name="id">
            
            <div class="form-row">
                <div class="form-group">
                    <label>R√©f√©rence *</label>
                    <input type="text" name="reference" id="produit-reference" required>
                </div>
                <div class="form-group">
                    <label>Code-barres</label>
                    <input type="text" name="code_barre" id="produit-code-barre">
                </div>
            </div>
            
            <div class="form-group">
                <label>Nom du produit *</label>
                <input type="text" name="nom" id="produit-nom" required>
            </div>
            
            <div class="form-group">
                <label>Description</label>
                <textarea name="description" id="produit-description" rows="3"></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Cat√©gorie</label>
                    <select name="categorie_id" id="produit-categorie"></select>
                </div>
                <div class="form-group">
                    <label>Fournisseur</label>
                    <select name="fournisseur_id" id="produit-fournisseur"></select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Prix d'achat *</label>
                    <input type="number" name="prix_achat" id="produit-prix-achat" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Prix de vente *</label>
                    <input type="number" name="prix_vente" id="produit-prix-vente" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>TVA (%)</label>
                    <input type="number" name="tva" id="produit-tva" step="0.01" value="18">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Stock actuel</label>
                    <input type="number" name="stock_actuel" id="produit-stock-actuel" value="0">
                </div>
                <div class="form-group">
                    <label>Stock minimum</label>
                    <input type="number" name="stock_min" id="produit-stock-min" value="0">
                </div>
                <div class="form-group">
                    <label>Stock maximum</label>
                    <input type="number" name="stock_max" id="produit-stock-max" value="1000">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Unit√© de mesure</label>
                    <select name="unite_mesure" id="produit-unite">
                        <option value="unit√©">Unit√©</option>
                        <option value="pi√®ce">Pi√®ce</option>
                        <option value="kg">Kilogramme</option>
                        <option value="litre">Litre</option>
                        <option value="m√®tre">M√®tre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Emplacement</label>
                    <input type="text" name="emplacement" id="produit-emplacement" placeholder="Ex: Rayon A-1">
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button type="submit" class="btn btn-primary">üíæ Enregistrer</button>
                <button type="button" class="btn btn-secondary" onclick="toggleModal('modal-produit')">‚ùå Annuler</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/produits.js') }}"></script>
{% endblock %}