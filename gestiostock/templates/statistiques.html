{% extends "base.html" %}

{% block title %}Statistiques - GestioStock{% endblock %}

{% block content %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/statistiques.css') }}">
<div class="header">
    <h1>ğŸ“ˆ Statistiques AvancÃ©es</h1>
    <p>Analyses dÃ©taillÃ©es de votre activitÃ© commerciale</p>
</div>

<!-- SÃ©lection de pÃ©riode -->
<div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="btn btn-primary" onclick="chargerStats('jour')">ğŸ“… Aujourd'hui</button>
        <button class="btn btn-primary" onclick="chargerStats('semaine')">ğŸ“† Cette semaine</button>
        <button class="btn btn-primary" onclick="chargerStats('mois')">ğŸ“Š Ce mois</button>
        <button class="btn btn-primary" onclick="chargerStats('annee')">ğŸ“ˆ Cette annÃ©e</button>
        <button class="btn btn-secondary" onclick="toggleModal('modal-periode-custom')">ğŸ—“ï¸ PÃ©riode personnalisÃ©e</button>
    </div>
</div>

<!-- KPIs principaux -->
<div class="stat-cards">
    <div class="stat-card">
        <div class="icon">ğŸ’°</div>
        <div class="label">Chiffre d'affaires</div>
        <div class="value" id="stat-ca">0 F</div>
        <small style="color: #27ae60;" id="stat-ca-evol">+0%</small>
    </div>
    <div class="stat-card">
        <div class="icon">ğŸ“¦</div>
        <div class="label">Nombre de ventes</div>
        <div class="value" id="stat-nb-ventes">0</div>
        <small style="color: #27ae60;" id="stat-ventes-evol">+0%</small>
    </div>
    <div class="stat-card">
        <div class="icon">ğŸ›’</div>
        <div class="label">Panier moyen</div>
        <div class="value" id="stat-panier">0 F</div>
        <small style="color: #7f8c8d;">Moyenne par transaction</small>
    </div>
    <div class="stat-card">
        <div class="icon">ğŸ’¹</div>
        <div class="label">Marge brute</div>
        <div class="value" id="stat-marge">0%</div>
        <small style="color: #7f8c8d;">RentabilitÃ©</small>
    </div>
</div>

<!-- Graphiques principaux -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;">
    <!-- Ã‰volution des ventes -->
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <h3 style="margin-bottom: 20px;">ğŸ“ˆ Ã‰volution des ventes (30 derniers jours)</h3>
        <canvas id="chart-evolution" style="max-height: 300px;"></canvas>
    </div>
    
    <!-- Ventes par catÃ©gorie -->
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <h3 style="margin-bottom: 20px;">ğŸ¯ Ventes par catÃ©gorie</h3>
        <canvas id="chart-categories" style="max-height: 300px;"></canvas>
    </div>
</div>

<!-- Top produits et clients -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
    <!-- Top 10 produits -->
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <h3 style="margin-bottom: 20px;">ğŸ† Top 10 Produits Vendus</h3>
        <table id="table-top-produits" style="box-shadow: none;">
            <thead>
                <tr>
                    <th>Rang</th>
                    <th>Produit</th>
                    <th>QuantitÃ©</th>
                    <th>CA</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <!-- Top 10 clients -->
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <h3 style="margin-bottom: 20px;">â­ Top 10 Clients</h3>
        <table id="table-top-clients" style="box-shadow: none;">
            <thead>
                <tr>
                    <th>Rang</th>
                    <th>Client</th>
                    <th>Achats</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Analyse de rentabilitÃ© -->
<div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px;">
    <h3 style="margin-bottom: 20px;">ğŸ’¹ Analyse de RentabilitÃ©</h3>
    <div class="stat-cards">
        <div class="stat-card">
            <div class="label">Chiffre d'affaires</div>
            <div class="value" id="rent-ca" style="color: #3498db;">0 F</div>
        </div>
        <div class="stat-card">
            <div class="label">CoÃ»t d'achat total</div>
            <div class="value" id="rent-cout" style="color: #e74c3c;">0 F</div>
        </div>
        <div class="stat-card">
            <div class="label">BÃ©nÃ©fice brut</div>
            <div class="value" id="rent-benefice" style="color: #27ae60;">0 F</div>
        </div>
        <div class="stat-card">
            <div class="label">Marge brute (%)</div>
            <div class="value" id="rent-marge-pct" style="color: #27ae60;">0%</div>
        </div>
    </div>
    
    <h4 style="margin: 25px 0 15px 0;">ğŸ¯ Produits les plus rentables</h4>
    <div id="produits-rentables"></div>
</div>

<!-- Modes de paiement et statistiques diverses -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <!-- Modes de paiement -->
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <h3 style="margin-bottom: 20px;">ğŸ’³ RÃ©partition des paiements</h3>
        <canvas id="chart-paiements" style="max-height: 250px;"></canvas>
    </div>
    
    <!-- Statistiques clients -->
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <h3 style="margin-bottom: 20px;">ğŸ‘¥ Statistiques Clients</h3>
        <canvas id="chart-clients" style="max-height: 250px;"></canvas>
    </div>
</div>

<!-- Modal PÃ©riode personnalisÃ©e -->
<div id="modal-periode-custom" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>SÃ©lectionner une pÃ©riode</h2>
            <span class="modal-close" onclick="toggleModal('modal-periode-custom')">&times;</span>
        </div>
        <form id="form-periode" onsubmit="chargerStatsCustom(event)">
            <div class="form-row">
                <div class="form-group">
                    <label>Date de dÃ©but</label>
                    <input type="date" id="date-debut-custom" required>
                </div>
                <div class="form-group">
                    <label>Date de fin</label>
                    <input type="date" id="date-fin-custom" required>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="submit" class="btn btn-primary">ğŸ“Š Analyser</button>
                <button type="button" class="btn btn-secondary" onclick="toggleModal('modal-periode-custom')">âŒ Annuler</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/chart.umd.js') }}"></script>
<script src="{{ url_for('static', filename='js/statistiques.js') }}"></script>
{% endblock %}