{% extends "base.html" %}

{% block title %}Ventes - GestioStock{% endblock %}

{% block content %}
<div class="header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>üõí Gestion des Ventes</h1>
            <p>Enregistrer et suivre vos ventes</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn btn-secondary" onclick="exporterVentes()">
                üì• Exporter Excel
            </button>
            <button class="btn btn-primary" onclick="toggleModal('modal-vente')">
                ‚ûï Nouvelle Vente
            </button>
        </div>
    </div>
</div>

<!-- Statistiques rapides -->
<div class="stat-cards">
    <div class="stat-card">
        <div class="icon">üí∞</div>
        <div class="label">CA Aujourd'hui</div>
        <div class="value" id="ca-jour">0 F</div>
    </div>
    <div class="stat-card">
        <div class="icon">üõçÔ∏è</div>
        <div class="label">Ventes aujourd'hui</div>
        <div class="value" id="nb-ventes-jour">0</div>
    </div>
    <div class="stat-card">
        <div class="icon">üì¶</div>
        <div class="label">Articles vendus</div>
        <div class="value" id="articles-vendus">0</div>
    </div>
</div>

<!-- Filtres -->
<div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <div class="form-row">
        <div class="form-group" style="margin: 0;">
            <input type="date" id="filter-date-debut">
        </div>
        <div class="form-group" style="margin: 0;">
            <input type="date" id="filter-date-fin">
        </div>
        <div class="form-group" style="margin: 0;">
            <select id="filter-client">
                <option value="">Tous les clients</option>
            </select>
        </div>
        <div class="form-group" style="margin: 0;">
            <select id="filter-statut">
                <option value="">Tous les statuts</option>
                <option value="confirm√©e">Confirm√©e</option>
                <option value="annul√©e">Annul√©e</option>
            </select>
        </div>
    </div>
</div>

<!-- Table des ventes -->
<div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <table id="ventes-table">
        <thead>
            <tr>
                <th>N¬∞ Facture</th>
                <th>Date</th>
                <th>Client</th>
                <th>Produit</th>
                <th>Quantit√©</th>
                <th>Montant</th>
                <th>Paiement</th>
                <th>Statut</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<!-- Modal Nouvelle Vente avec Panier -->
<div id="modal-vente" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Nouvelle Vente</h2>
            <span class="modal-close" onclick="toggleModal('modal-vente')">&times;</span>
        </div>
        <form id="form-vente">
            <!-- Client -->
            <div class="form-group">
                <label>Client</label>
                <select name="client_id" id="vente-client">
                    <option value="">Client anonyme</option>
                </select>
            </div>

            <!-- S√©lection produit et quantit√© -->
            <div class="form-row">
                <div class="form-group">
                    <label>Produit *</label>
                    <select name="produit_id" id="vente-produit" required>
                        <option value="">S√©lectionner un produit</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantit√© *</label>
                    <input type="number" name="quantite" id="vente-quantite" required min="1">
                    <div id="stock-indicator" style="color:#e74c3c; font-size:12px; display:none;">
                        ‚ö†Ô∏è Stock insuffisant !
                    </div>
                </div>
                <div class="form-group">
                    <label>Prix unitaire</label>
                    <input type="number" name="prix_unitaire" id="vente-prix" step="0.01" readonly>
                </div>
                <div class="form-group">
                    <label>Remise (%)</label>
                    <input type="number" name="remise" id="vente-remise" step="0.01" value="0" min="0" max="100">
                </div>
            </div>

            <div class="form-row" style="align-items:center; gap:10px; margin-bottom:10px;">
                <div class="form-group">
                    <label>Devise</label>
                    <select name="devise" id="vente-devise">
                        <option value="XOF">F CFA (XOF)</option>
                        <option value="EUR">Euro (EUR)</option>
                        <option value="USD">Dollar (USD)</option>
                        <option value="GBP">Livre Sterling (GBP)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mode de paiement</label>
                    <select name="mode_paiement" id="vente-paiement">
                        <option value="esp√®ces">Esp√®ces</option>
                        <option value="carte">Carte bancaire</option>
                        <option value="mobile">Mobile Money</option>
                        <option value="virement">Virement</option>
                    </select>
                </div>
                <div class="form-group" style="margin-top:24px;">
                    <button type="button" class="btn btn-secondary" onclick="ventesManager.ajouterAuPanier()">
                        ‚ûï Ajouter au panier
                    </button>
                </div>
            </div>

            <!-- Panier -->
            <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h4>üõí Panier</h4>
                <table id="panier-table" style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr>
                            <th>Produit</th>
                            <th>Qt√©</th>
                            <th>Prix unitaire</th>
                            <th>Remise</th>
                            <th>Total</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6" style="text-align:center; color:#7f8c8d;">Le panier est vide</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Total g√©n√©ral -->
            <div style="background: #e8f8f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 18px; font-weight: 600; color: #2c3e50;">TOTAL √Ä PAYER:</span>
                    <span style="font-size: 24px; font-weight: bold; color: #1abc9c;" id="vente-total">0 F CFA</span>
                </div>
            </div>

            <!-- Notes et boutons -->
            <div class="form-group">
                <label>Notes</label>
                <textarea name="notes" id="vente-notes" rows="2"></textarea>
            </div>

            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">üí∞ Enregistrer la vente</button>
                <button type="button" class="btn btn-secondary" onclick="toggleModal('modal-vente')">‚ùå Annuler</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/ventes.js') }}"></script>
{% endblock %}